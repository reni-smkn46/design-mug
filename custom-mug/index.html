<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Custom Design Mug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fabric JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-7xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4 text-center">Website Custom Design Mug</h1>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

        <!-- TOOLBAR -->
        <div class="bg-white p-4 rounded shadow space-y-3">

            <h2 class="font-semibold">Tools</h2>

            <!-- Upload Gambar -->
            <input type="file" id="uploadImage" accept="image/*"
                class="w-full text-sm">

            <!-- Tambah Teks -->
            <button onclick="addText()"
                class="w-full bg-blue-500 text-white py-2 rounded">
                Tambah Teks
            </button>

            <!-- Warna Teks -->
            <input type="color" onchange="changeColor(this.value)"
                class="w-full h-10">

            <!-- Hapus -->
            <button onclick="deleteObject()"
                class="w-full bg-red-500 text-white py-2 rounded">
                Hapus Objek
            </button>

            <!-- Download -->
            <button onclick="downloadDesign()"
                class="w-full bg-green-500 text-white py-2 rounded">
                Download Desain
            </button>
        </div>

        <!-- CANVAS -->
        <div class="md:col-span-3 bg-white p-4 rounded shadow">
            <canvas id="mugCanvas" width="900" height="400"
                class="border mx-auto"></canvas>
        </div>

    </div>
</div>

<script>
    // ========================
    // INISIALISASI CANVAS
    // ========================
    const canvas = new fabric.Canvas('mugCanvas', {
        backgroundColor: '#ffffff',
        preserveObjectStacking: true
    });

    // ========================
    // LOAD FRAME MUG
    // ========================
    fabric.Image.fromURL('assets/frames/mug-frame.png', function (img) {
        img.scaleToWidth(canvas.width);
        img.selectable = false;
        img.evented = false;
        canvas.add(img);
        canvas.sendToBack(img);
    });

    // ========================
    // UPLOAD GAMBAR
    // ========================
    document.getElementById('uploadImage').addEventListener('change', function (e) {
        const reader = new FileReader();
        reader.onload = function () {
            fabric.Image.fromURL(reader.result, function (img) {
                img.scale(0.3);
                img.set({
                    left: 200,
                    top: 100
                });
                canvas.add(img);
                canvas.setActiveObject(img);
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    // ========================
    // TAMBAH TEKS
    // ========================
    function addText() {
        const text = new fabric.Textbox('Teks Mug', {
            left: 250,
            top: 150,
            fontSize: 32,
            fill: '#000000'
        });
        canvas.add(text);
        canvas.setActiveObject(text);
    }

    // ========================
    // GANTI WARNA TEKS
    // ========================
    function changeColor(color) {
        const obj = canvas.getActiveObject();
        if (obj && obj.type === 'textbox') {
            obj.set('fill', color);
            canvas.renderAll();
        }
    }

    // ========================
    // HAPUS OBJEK
    // ========================
    function deleteObject() {
        const obj = canvas.getActiveObject();
        if (obj) {
            canvas.remove(obj);
        }
    }

    // ========================
    // DOWNLOAD DESAIN
    // ========================
    function downloadDesign() {
        canvas.discardActiveObject();
        canvas.renderAll();

        const dataURL = canvas.toDataURL({
            format: 'png',
            quality: 1
        });

        const link = document.createElement('a');
        link.href = dataURL;
        link.download = 'desain-mug.png';
        link.click();
    }
</script>

</body>
</html>
